# üõ°Ô∏è Guia de Pentest e Testes de Seguran√ßa - TarefaM√°gica

## Objetivo
Este documento orienta como realizar testes de penetra√ß√£o (pentest) e automa√ß√£o de testes de seguran√ßa no TarefaM√°gica, garantindo a robustez das defesas implementadas.

---

## 1. Checklist de Testes de Seguran√ßa

### 1.1. Autentica√ß√£o e Autoriza√ß√£o
- [ ] Teste de for√ßa bruta em login
- [ ] Bypass de autentica√ß√£o (ex: JWT inv√°lido, sess√£o expirada)
- [ ] Escalada de privil√©gios (testar roles e permiss√µes)
- [ ] Teste de 2FA (TOTP, backup codes)

### 1.2. Valida√ß√£o e Sanitiza√ß√£o
- [ ] SQL Injection (inputs, APIs)
- [ ] XSS (Cross-Site Scripting)
- [ ] Path Traversal
- [ ] Command Injection
- [ ] Teste de uploads (arquivos maliciosos)

### 1.3. Seguran√ßa de Comunica√ß√£o
- [ ] Valida√ß√£o de SSL/TLS (certificados, for√ßa de cifra)
- [ ] Teste de headers HTTP (CSP, HSTS, X-Frame-Options, etc.)
- [ ] Teste de CORS

### 1.4. Prote√ß√£o de Dados
- [ ] Teste de criptografia de dados sens√≠veis
- [ ] Teste de backup seguro (acesso, descriptografia)
- [ ] Teste de integridade de dados

### 1.5. Monitoramento e Auditoria
- [ ] Teste de gera√ß√£o e sanitiza√ß√£o de logs
- [ ] Teste de alertas e detec√ß√£o de anomalias
- [ ] Teste de auditoria de a√ß√µes cr√≠ticas

### 1.6. Rate Limiting e Timeout
- [ ] Teste de rate limiting (excesso de requisi√ß√µes)
- [ ] Teste de timeout de sess√£o

### 1.7. Consentimento e LGPD
- [ ] Teste de fluxo de consentimento parental
- [ ] Teste de revoga√ß√£o e expira√ß√£o de consentimento
- [ ] Teste de exporta√ß√£o e exclus√£o de dados

---

## 2. Ferramentas Recomendadas

- **OWASP ZAP**: Scanner de vulnerabilidades web
- **Burp Suite**: Proxy para an√°lise e manipula√ß√£o de requisi√ß√µes
- **Nikto**: Scanner de vulnerabilidades em servidores web
- **sqlmap**: Testes de SQL Injection
- **wpscan**: (se usar WordPress)
- **nmap**: Varredura de portas e servi√ßos
- **sslscan/ssllabs**: Testes de SSL/TLS
- **Bandit**: An√°lise est√°tica de c√≥digo Python
- **pytest + pytest-security**: Testes automatizados

---

## 3. Automa√ß√£o de Testes de Seguran√ßa

### 3.1. Testes Automatizados com pytest

Crie testes em `tests/security/`:
```python
import pytest
import requests

def test_rate_limiting():
    url = 'https://localhost:8000/api/login'
    for _ in range(10):
        r = requests.post(url, json={'user': 'test', 'password': 'wrong'})
    assert r.status_code == 429  # Too Many Requests

def test_sql_injection():
    url = 'https://localhost:8000/api/financial'
    payload = {"account": "' OR 1=1;--"}
    r = requests.post(url, json=payload)
    assert r.status_code in (400, 422)
```

### 3.2. Testes de Headers HTTP
```python
import requests

def test_security_headers():
    r = requests.get('https://localhost:8000/')
    assert 'X-Content-Type-Options' in r.headers
    assert 'Strict-Transport-Security' in r.headers
    assert 'Content-Security-Policy' in r.headers
```

### 3.3. Testes de Consentimento LGPD
```python
import requests

def test_consent_flow():
    # Simular fluxo de consentimento parental
    r = requests.post('https://localhost:8000/api/consent', json={...})
    assert r.status_code == 200
```

---

## 4. Integra√ß√£o com CI/CD

- Adicione os testes de seguran√ßa ao pipeline (ex: GitHub Actions, GitLab CI):
```yaml
- name: Run security tests
  run: pytest tests/security/
```
- Use Bandit para an√°lise est√°tica:
```yaml
- name: Bandit security scan
  run: bandit -r workflow/
```
- Use OWASP ZAP CLI para scan automatizado:
```yaml
- name: OWASP ZAP Baseline Scan
  run: zap-baseline.py -t https://localhost:8000
```

---

## 5. Relat√≥rios e Corre√ß√£o

- Gere relat√≥rios de vulnerabilidades ap√≥s cada rodada de testes
- Classifique e priorize corre√ß√µes (CVSS, impacto, facilidade de explora√ß√£o)
- Documente as corre√ß√µes e revalide ap√≥s ajustes

---

## 6. Refer√™ncias
- [OWASP Top 10](https://owasp.org/www-project-top-ten/)
- [Guia LGPD](https://www.gov.br/anpd/pt-br/assuntos/guia-lgpd)
- [Bandit](https://bandit.readthedocs.io/)
- [pytest](https://docs.pytest.org/)

---

**Respons√°vel:** Equipe de Seguran√ßa - TarefaM√°gica 